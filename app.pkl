// App native generation config
// Run: cargo run --manifest-path flutter_tools/flutter_gen_platforms/Cargo.toml -- --config app.pkl

import "pkl:yaml"

typealias ProjectName = String(matches(Regex(#"^[A-Za-z][A-Za-z0-9_]*$"#)))
typealias Org = String(matches(Regex(#"^[A-Za-z][A-Za-z0-9_]*(\.[A-Za-z][A-Za-z0-9_]*)*$"#)))

local pubspecYaml = read("pubspec.yaml")
local pubspecData = new yaml.Parser { useMapping = true }.parse(pubspecYaml)
local appVersion = pubspecData["version"] as String

project_name: ProjectName = pubspecData["name"] as String
org: Org = "org.vidlg"
description: String(length > 0) = "webfly is like webf go / expo go, focused on rendering target web pages"

pubspec {
  name = pubspecData["name"] as String
  description = pubspecData["description"] as String
  version = appVersion
  homepage = pubspecData["homepage"] as String
}

platforms_dir = "platforms"

create {
  platforms = List("android", "windows")
  android_language = "kotlin"
}

android {
  gradle_wrapper {
    distribution_url = "https://mirrors.huaweicloud.com/gradle/gradle-8.14-all.zip"
  }

  // Template variables for platforms/android/app/build.gradle.kts
  template_vars {
    namespace = "\(org).\(project_name)"
    application_id = "\(org).\(project_name)"
    output_file_name = "\(project_name)-v${defaultConfig.versionName}+${defaultConfig.versionCode}-${name}.apk"
    key_alias = "\(project_name)"
    store_file = "../../\(platforms_dir)/android/keystore.jks"
  }
}

windows {
  // Windows platform configuration (minimal - using defaults from flutter create)
  enabled = true
  window_width = 720
  window_height = 1280
}

ios = null
