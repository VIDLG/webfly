// App native generation config
// Run: rust-script flutter/tools/flutter-gen-platforms.rs --config flutter/app.pkl

typealias ProjectName = String(matches(Regex(#"^[A-Za-z][A-Za-z0-9_]*$"#)))
typealias Org = String(matches(Regex(#"^[A-Za-z][A-Za-z0-9_]*(\.[A-Za-z][A-Za-z0-9_]*)*$"#)))

project_name: ProjectName = "webfly"
org: Org = "org.vidlg"
description: String(length > 0) = "webfly is like webf go / expo go, focused on rendering target web pages"

create {
  platforms = List("android")
  android_language = "kotlin"
}

android {
  gradle_wrapper {
    distribution_url = "https://mirrors.huaweicloud.com/gradle/gradle-8.14-all.zip"
  }

  app {
    build {
      application_id = "\(org).\(project_name)"
      namespace = "\(org).\(project_name)"
    }

    manifest {
      main {
        application_label = project_name
        uses_cleartext_traffic = true
        enable_on_back_invoked_callback = true
        permissions = new Listing {
          new { name = "android.permission.CAMERA" }
          new { name = "android.permission.RECORD_AUDIO" }
          new { name = "android.permission.INTERNET" }
          new { name = "android.permission.READ_MEDIA_IMAGES" }
          new { name = "android.permission.READ_MEDIA_VIDEO" }
          new { name = "android.permission.READ_MEDIA_AUDIO" }
          new { name = "android.permission.READ_EXTERNAL_STORAGE"; max_sdk_version = 32 }
          new { name = "android.permission.WRITE_EXTERNAL_STORAGE"; max_sdk_version = 28 }
          // Bluetooth permissions (legacy for API <= 30)
          new { name = "android.permission.BLUETOOTH"; max_sdk_version = 30 }
          new { name = "android.permission.BLUETOOTH_ADMIN"; max_sdk_version = 30 }
          // Bluetooth permissions (API >= 31)
          new { name = "android.permission.BLUETOOTH_SCAN"; uses_permission_flags = "neverForLocation"; target_api = "s" }
          new { name = "android.permission.BLUETOOTH_CONNECT" }
          // Location permissions for Bluetooth (API <= 30)
          new { name = "android.permission.ACCESS_FINE_LOCATION"; max_sdk_version = 30 }
          new { name = "android.permission.ACCESS_COARSE_LOCATION"; max_sdk_version = 30 }
        }
      }

      debug = null
      profile = null
    }
  }

  build {
    allprojects {
      repositories = List(
        "https://maven.aliyun.com/repository/public",
        "https://maven.aliyun.com/repository/google",
        "https://maven.aliyun.com/repository/jcenter"
      )
    }
  }

  settings {
    plugin_management {
      repositories = List(
        "https://maven.aliyun.com/repository/public",
        "https://maven.aliyun.com/repository/google",
        "https://maven.aliyun.com/repository/gradle-plugin",
        "https://maven.aliyun.com/repository/jcenter"
      )
    }
  }
}

ios = null
