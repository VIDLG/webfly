// App native generation config
// Run: rust-script flutter/tools/flutter-gen-platforms.rs --config flutter/app.pkl

typealias ProjectName = String(matches(Regex(#"^[A-Za-z][A-Za-z0-9_]*$"#)))
typealias Org = String(matches(Regex(#"^[A-Za-z][A-Za-z0-9_]*(\.[A-Za-z][A-Za-z0-9_]*)*$"#)))

project_name: ProjectName = "webfly"
org: Org = "org.vidlg"
description: String(length > 0) = "webfly is like webf go / expo go, focused on rendering target web pages"

create {
  platforms = List("android")
  android_language = "kotlin"
}

android {
  gradle_wrapper {
    distribution_url = "https://mirrors.huaweicloud.com/gradle/gradle-8.14-all.zip"
  }

  app {
    build {
      application_id = "\(org).\(project_name)"
      namespace = "\(org).\(project_name)"
    }

    manifest {
      main {
        application_label = project_name
        uses_cleartext_traffic = true
        enable_on_back_invoked_callback = true
        permissions = List(
          "android.permission.CAMERA",
          "android.permission.RECORD_AUDIO",
          "android.permission.INTERNET",
          "android.permission.READ_MEDIA_IMAGES",
          "android.permission.READ_MEDIA_VIDEO",
          "android.permission.READ_MEDIA_AUDIO",
          "android.permission.READ_EXTERNAL_STORAGE",
          "android.permission.WRITE_EXTERNAL_STORAGE",
          // Bluetooth permissions (legacy for API <= 30)
          "android.permission.BLUETOOTH",
          "android.permission.BLUETOOTH_ADMIN",
          // Bluetooth permissions (API >= 31)
          "android.permission.BLUETOOTH_SCAN",
          "android.permission.BLUETOOTH_CONNECT",
          // Location permissions for Bluetooth (API <= 30)
          "android.permission.ACCESS_FINE_LOCATION",
          "android.permission.ACCESS_COARSE_LOCATION"
        )
        read_external_storage_max_sdk = 32
      }

      debug = null
      profile = null
    }
  }

  build {
    allprojects {
      repositories = List(
        "https://maven.aliyun.com/repository/public",
        "https://maven.aliyun.com/repository/google",
        "https://maven.aliyun.com/repository/jcenter"
      )
    }
  }

  settings {
    plugin_management {
      repositories = List(
        "https://maven.aliyun.com/repository/public",
        "https://maven.aliyun.com/repository/google",
        "https://maven.aliyun.com/repository/gradle-plugin",
        "https://maven.aliyun.com/repository/jcenter"
      )
    }
  }
}

ios = null
